<!-- Select -->
<div class="content">
  <mat-label class="label" for="country-select">Sélectionner un pays</mat-label>
  <mat-select role="listbox" [(ngModel)]="selectedCountry" (ngModelChange)="onSelectCountry()"
    [compareWith]="compareFn">
    <mat-select-trigger>
      <img alt="selectedCountry.translation" [height]="32" [width]="32" [src]="selectedCountry.flag" />
      {{selectedCountry.translation}}
    </mat-select-trigger>
    <mat-option role="option">
      <ngx-mat-select-search ngModel placeholderLabel="Rechercher un pays..." noEntriesFoundLabel="Pays inconnu"
        clearSearchInput="true" (ngModelChange)="filterCountries($event)">
      </ngx-mat-select-search>
    </mat-option>
    <mat-option role="option" *ngFor="let country of filteredCountries; trackByFn" [value]="country">
      <img alt="country.translation" [height]="32" [width]="32" [src]="country.flag" />
      {{country.translation}}
    </mat-option>
  </mat-select>
</div>

<!-- Description -->
<div class="content">
  <p class="description" *ngIf="selectedCountry.country === 'Monde'">
    Suivez en direct l'épidémie du <strong>Coronavirus COVID-19</strong> avec le nombre de cas recensés, le nombre
    de morts et de cas guéris en <strong>France</strong> et dans le monde entier: <strong>Italie, Espagne,
      Chine</strong> à travers un dashboard et des graphiques détaillés.
  </p>
  <p class="description" *ngIf="selectedCountry.country !== 'Monde'">
    Suivez en direct l'épidémie du <strong>Coronavirus COVID-19</strong> avec le nombre de cas recensés, le nombre
    de morts et de cas guéris en <strong>
      <ng-container *ngIf="selectedCountry.translation">
        {{selectedCountry.translation}}
      </ng-container>
      <ng-container *ngIf="!selectedCountry.translation">
        {{selectedCountry.country}}
      </ng-container>
    </strong>
    à travers un dashboard et des graphiques détaillés.
  </p>
</div>

<!-- Graph Content -->
<ng-container *ngIf="(detailedStats$ | loading | async) as detailedStats">
  <ng-container *ngIf="detailedStats.value && detailedStats.value.length > 0">

    <!-- World Container-->
    <ng-container *ngIf="selectedCountry.country !== 'France'">
      <app-coronavirus-stats [mainStats]="detailedStats.value | countryfilter: this.selectedCountry.code"
        [selectedCountry]="selectedCountry" (updateMapEvent)="onUpdateMapEvent($event)"></app-coronavirus-stats>
      <div class="columns">
        <div class="column is-two-thirds" *ngIf="isBrowser">
          <ng-container *ngIf="selectedCountry.country === 'Monde'">
            <app-coronavirus-map [selectedDivisionMap]="'world'" [selectedCountry]="selectedCountry"
              [detailedStats]="detailedStats.value | countryfilter: ''" [selectedTypeMap]="selectedTypeMap">
            </app-coronavirus-map>
          </ng-container>
          <ng-container *ngIf="selectedCountry.country !== 'Monde'">
            <app-coronavirus-map [selectedDivisionMap]="'world'" [selectedCountry]="selectedCountry"
              [detailedStats]="detailedStats.value | countryfilter: selectedCountry.code"
              [selectedTypeMap]="selectedTypeMap">
            </app-coronavirus-map>
          </ng-container>
        </div>
        <div class="column" *ngIf="selectedCountry.country === 'Monde'">
          <app-coronavirus-table [detailedStats]="detailedStats.value | countryfilter: ''"
            [selectedCountry]="selectedCountry">
          </app-coronavirus-table>
        </div>
        <div class="column" *ngIf="selectedCountry.country !== 'Monde'">
          <ng-container *ngIf="(tableStatsByCountry$ | loading | async) as tableStatsByCountry">
            <ng-container *ngIf="tableStatsByCountry.value && tableStatsByCountry.value.length > 0">
              <app-coronavirus-table [detailedStats]="tableStatsByCountry.value" [selectedCountry]="selectedCountry">
              </app-coronavirus-table>
            </ng-container>
            <ng-container *ngIf="!tableStatsByCountry.value && !tableStatsByCountry.loading">
              <article class="message is-danger is-spaced">
                <div class="message-header">
                  <p>Données indisponibles</p>
                </div>
                <div class="message-body">
                  Nous n'avons pas trouvé de données.
                </div>
              </article>
            </ng-container>
            <ng-container *ngIf="detailedStats.loading">
              <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </ng-container>

    <!-- France Container -->
    <ng-container *ngIf="selectedCountry.country === 'France'">
      <app-coronavirus-stats [mainStats]="detailedStats.value | countryfilter: 'WL'"
        [selectedCountry]="{country: 'Monde', slug: 'monde', translation: 'Monde', code: 'WL'}"></app-coronavirus-stats>
      <ng-container *ngIf="(franceStats$ | loading | async) as franceStats">
        <ng-container *ngIf="franceStats.value">
          <app-coronavirus-stats [mainStats]="detailedStats.value | countryfilter: 'FR'"
            [franceStats]="franceStats.value"
            [selectedCountry]="{country: 'France', slug: 'france', translation: 'France', code: 'FR'}"
            (updateMapEvent)="onUpdateMapEvent($event)">
          </app-coronavirus-stats>


          <div class="columns">
            <div class="column" *ngIf="isBrowser">

              <mat-label class="label" for="country-select">Sélectionner un découpage</mat-label>
              <mat-select role="listbox" [(ngModel)]="selectedDivisionMap">
                <mat-option role="option" [value]="'regionFrance'">
                  Par région
                </mat-option>
                <mat-option role="option" [value]="'departmentFrance'">
                  Par département
                </mat-option>
              </mat-select>

              <app-coronavirus-map [selectedCountry]="selectedCountry" [selectedDivisionMap]="selectedDivisionMap"
                [detailedStats]="selectedDivisionMap === 'regionFrance' ?
              franceStats.value.statsByRegion : franceStats.value.statsByDepartment"
                [selectedTypeMap]="selectedTypeMap"></app-coronavirus-map>
            </div>
            <div class="column">
              <app-coronavirus-table [detailedStats]="selectedDivisionMap === 'regionFrance' ?
              franceStats.value.statsByRegion : franceStats.value.statsByDepartment"
                [selectedCountry]="selectedCountry">
              </app-coronavirus-table>
            </div>
          </div>
          <div class="columns">
            <div class="column" *ngIf="isBrowser">
              <app-coronavirus-chart-gender [dataGender]="franceStats.value.statsByGender">
              </app-coronavirus-chart-gender>
            </div>
            <div class="column" *ngIf="isBrowser">
              <ng-container *ngIf="(franceStatsByAge$ | loading | async) as franceStatsByAge">
                <ng-container *ngIf="franceStatsByAge.value">
                  <app-coronavirus-chart-age [dataAge]="franceStatsByAge.value"></app-coronavirus-chart-age>
                </ng-container>
              </ng-container>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="!(franceStats.value) && !franceStats.loading">
          <article class="message is-danger is-spaced">
            <div class="message-header">
              <p>Données indisponibles</p>
            </div>
            <div class="message-body">
              Nous n'avons pas trouvé de données.
            </div>
          </article>
        </ng-container>
        <ng-container *ngIf="franceStats.loading">
          <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
        </ng-container>
      </ng-container>

    </ng-container>

  </ng-container>
  <ng-container *ngIf="(detailedStats.value && detailedStats.value.length === 0) && !detailedStats.loading">
    <article class="message is-danger is-spaced">
      <div class="message-header">
        <p>Données indisponibles</p>
      </div>
      <div class="message-body">
        Nous n'avons pas trouvé de données.
      </div>
    </article>
  </ng-container>
  <ng-container *ngIf="detailedStats.loading">
    <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
  </ng-container>
</ng-container>

<!-- Graph Footer-->
<div class="content" *ngIf="(data$ | loading | async) as data">
  <ng-container *ngIf="isBrowser">
    <h1 class="title is-spaced">L'avancée du coronavirus sur les 15 derniers jours</h1>
    <div class="columns" *ngIf="selectedCountry.country === 'Monde'">
      <ng-container *ngIf="data.value">
        <div class="column">
          <app-coronavirus-graph [data]="data.value"></app-coronavirus-graph>
        </div>
        <div class="column">
          <app-coronavirus-column [data]="data.value"></app-coronavirus-column>
        </div>
      </ng-container>
    </div>
    <ng-container *ngIf="!data.value && !data.loading">
      <article class="message is-danger is-spaced">
        <div class="message-header">
          <p>Données indisponibles</p>
        </div>
        <div class="message-body">
          Nous n'avons pas trouvé de données.
        </div>
      </article>
    </ng-container>
    <ng-container *ngIf="data.loading">
      <mat-spinner [diameter]="60" class="spinner is-spaced"></mat-spinner>
    </ng-container>
    <div class="columns" *ngIf="selectedCountry.country !== 'Monde'">
      <div class="column">
        <ng-container *ngIf="(dataConfirmed$ | async) as dataConfirmed">
          <ng-container *ngIf="(dataRecovered$ | async) as dataRecovered">
            <ng-container *ngIf="(dataDeaths$ | async) as dataDeaths">
              <app-coronavirus-graph [dataConfirmed]="dataConfirmed" [dataRecovered]="dataRecovered"
                [dataDeaths]="dataDeaths"></app-coronavirus-graph>
            </ng-container>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </ng-container>
</div>
